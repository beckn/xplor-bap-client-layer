<!DOCTYPE html>
<html>
  <head>
    <title>Application Form</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        width: 100%;
        padding: 30px;
      }
      form {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .container {
        width: 100%;
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-size: 40px;
        padding: 6px 0;
      }
      input[type='text'],
      input[type='email'],
      input[type='date'],
      select {
        width: 100%;
        margin-bottom: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        min-height: 100px;
        font-size: 40px;
        text-indent: 15px;
      }
      input[type='radio'] {
        width: 100%;
        height: 40px;
        max-width: 40px;
      }
      button {
        padding: 10px 15px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        display: block;
        margin: 20px auto;
      }
      button:hover {
        background-color: #0056b3;
      }
      .error {
        color: red;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 style="font-size: 80px">KYC Form</h1>

      <form id="kycForm" action="/v1/e-auth/submitKycForm" , method="post">
        <div class="form-group">
          <label for="firstName">First Name:</label>
          <input type="text" id="firstName" name="firstName" placeholder="Enter first name" required />
        </div>
        <div class="form-group">
          <label for="lastName">Last Name:</label>
          <input type="text" id="lastName" name="lastName" placeholder="Enter last name" required />
        </div>
        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" id="email" name="email" placeholder="Enter your email" required />
        </div>
        <div class="form-group">
          <label for="houseNumber">House Number:</label>
          <input type="text" id="houseNumber" name="houseNumber" placeholder="House Number" required />
        </div>
        <div class="form-group">
          <label for="street">Street:</label>
          <input type="text" id="street" name="street" placeholder="Street" required />
        </div>
        <div class="form-group">
          <label for="locality">Locality:</label>
          <input type="text" id="locality" name="locality" placeholder="Locality" required />
        </div>
        <div class="form-group">
          <label for="landmark">Landmark:</label>
          <input type="text" id="landmark" name="landmark" placeholder="Landmark" />
        </div>
        <div class="form-group">
          <label for="district">District:</label>
          <input type="text" id="district" name="district" placeholder="District" required />
        </div>
        <div class="form-group">
          <label for="state">State:</label>
          <input type="text" id="state" name="state" placeholder="State" required />
        </div>
        <div class="form-group">
          <label for="pincode">Pincode:</label>
          <input type="text" id="pincode" name="pincode" placeholder="Pincode" required />
        </div>
        <div class="form-group">
          <label for="phone">Phone:</label>
          <input type="text" id="phone" name="phone" placeholder="Phone" />
        </div>
        <div class="form-group">
          <label>Gender:</label>
          <label><input type="radio" name="gender" value="Male" checked /> Male</label>
          <label><input type="radio" name="gender" value="Female" /> Female</label>
        </div>
        <div class="form-group">
          <label for="dob">Date of Birth:</label>
          <input type="date" id="dob" name="dob" required />
        </div>
        <input type="hidden" id="authToken" name="authToken" value="<%= authToken %>" />
        <button type="submit">Submit</button>
      </form>
    </div>
    <script>
      document.getElementById('kycForm').addEventListener('submit', function (event) {
        event.preventDefault(); // Prevent the form from submitting the traditional way
        const authToken = document.getElementById('authToken').value;

        const formData = new FormData(event.target); // Get the form data
        const formValues = Object.fromEntries(formData.entries()); // Convert to an object

        // Structure the address as a nested object
        const address = {
          careOf: formValues.lastName,
          district: formValues.district,
          houseNumber: formValues.houseNumber,
          landmark: formValues.landmark,
          locality: formValues.locality,
          phone: formValues.phone,
          pincode: formValues.pincode,
          postOffice: formValues.pincode,
          state: formValues.state,
          street: formValues.street,
          subDistrict: formValues.district,
        };

        // Construct the final data object
        const data = {
          firstName: formValues.firstName || 'first',
          lastName: formValues.lastName || 'first',
          email: formValues.email || 'first',
          address: address || 'first',
          gender: formValues.gender || 'first',
          dob: formValues.dob || 'first',
          authToken: authToken || 'first', // Include the authToken retrieved from URL
          urlParams: urlParams || 'first',
        };

        // Log the data to see what is being sent
        console.log('data', data);

        // Send the POST request
        fetch('/v1/e-auth/submitKycForm', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            Authorization: `${authToken}`,
          },
          body: JSON.stringify(data),
        })
          .then((response) => {
            return response.json();
          })
          .then((data) => {
            console.log('Success:', data);
            // Uncomment to redirect after successful POST request
            // window.location.href = `http://localhost:8000/v1/e-auth/callback?state=${queryString}`;
          })
          .catch((error) => {
            console.error('There was a problem with the fetch operation:', error);
          });
      });
      // });
    </script>
  </body>
</html>
